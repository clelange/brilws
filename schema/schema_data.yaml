#
# Schema for data
#


##### Data tables #####

TIMEINDEX:        #per ls
   columns:
    - fillnum: uint32
    - runnum: uint32
    - lsnum: uint32
    - timestampsec: uint32
    - timestampmsec: uint32
    - timestampstr: string       #just for display. do not query
    - weekofyear: uint16
    - dayofyear: uint16
    - dayofweek: uint16
    - year: uint16
    - month: uint16    
   pk: [runnum,lsnum]

DATATAGS:          
   columns:
    - datatagnameid: int64 
    - datatagname: string
    - creationutc: string
    - comments: string
   pk: [datatagnameid]
   unique: [datatagname]

IDS_DATATAG:     #per ls
   columns:
    - datatagnameid: int64
    - datatagid: int64
    - fillnum: uint32
    - runnum: uint32
    - lsnum: uint32
    - timestampsec: uint32
    - cmson: bool
    - norb: uint32
    - targetegev: uint16
    - beamstatus: string
    - amodetag: string
   pk: [datatagid] 
   unique: [ [datatagnameid,runnum,lsnum] ]
   
RUNINFO:          #per run
   columns:       
    - datatagid: int64
    - runnum: uint32
    - hltkey: string
    - gt_rs_key: string
    - trgmask: string
    - fillscheme: string
    - ncollidingbx: uint16
    - nbperls: uint16
   pk: [datatagid]

BEAM_&suffix:         #per ls
   columns:
    - datatagid: int64    
    - egev: float
    - intensity1: float
    - intensity2: float
   pk: [datatagid]

BX_BEAM_&suffix:  #per ls, per bx
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxintensity1: float
    - bxintensity2: float
    - iscolliding: bool
   pk: [datatagid,bxidx]

TRG_&suffix:               #per ls, per trg bit
   columns:
    - datatagid: int64
    - bitid: uint16
    - bitnameid: uint16 #tech bit alias id is 65535
    - prescidx: uint16
    - prescval: uint32  
    - counts: uint32
   pk: [datatagid,bitnameid]
   
HLT_&suffix:  #per ls, per hltpath
   columns:
    - datatagid: int64
    - hltpathid: uint32
    - prescidx: uint16
    - prescval: uint32
    - l1pass: uint32
    - hltaccept: uint32
   pk: [datatagid,hltpathid]

DEADTIME_&suffix:       #per ls
   columns:
    - datatagid: int64
    - deadtimefrac: float
   pk: [datatagid] 

HFOC_&suffix:
   columns:
    - datatagid: int64
    - avgrawlumi: float
   pk: [ datatagid ]
   
BX_HFOC_&suffix:       #per ls, per bx
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxrawlumi: float
   pk: [datatagid,bxidx]

HFET_&suffix:
   columns:
    - datatagid: int64
    - avgrawlumi: float
   pk: [ datatagid ]

BX_HFET_&suffix:       #per ls, per bx
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxrawlumi: float
   pk: [datatagid,bxidx]

BCM1F_&suffix:
   columns:
    - datatagid: int64
    - avgrawlumi: float
    - bkgplusz: float
    - bkgminusz: float
   pk: [ datatagid ]
   
BX_BCM1F_&suffix:       #per ls, per bx
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxrawlumi: float
   pk: [datatagid,bxidx]

PLT_&suffix: #per ls
   columns:
    - datatagid: int64
    - avgrawlumi: float
   pk: [ datatagid ]
   
BX_PLT_&suffix:          #per ls, per bx
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxrawlumi: float
   pk: [datatagid,bxidx]

PIXEL_&suffix:        #per ls
   columns:
    - datatagid: int64
    - avglumi: float
   pk: [datatagid]

##### Result tables #####

HFOC_RESULT_&suffix:
   columns:
    - datatagid: int64
    - normtagid: int64
    - avglumi: float
    - recorded: float
    - avgpu: float
   pk: [datatagid,normtagid]
   
BX_HFOC_RESULT_&suffix:
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxlumi: float
   pk: [datatagid,bxidx]

HFET_RESULT_&suffix:
   columns:
    - datatagid: int64
    - normtagid: int64
    - avglumi: float
    - recorded: float
    - avgpu: float
   pk: [datatagid,normtagid]
   
BX_HFET_RESULT_&suffix:
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxlumi: float
   pk: [datatagid,bxidx]

PLT_RESULT_&suffix:
   columns:
    - datatagid: int64
    - normtagid: int64
    - avglumi: float
    - recorded: float
    - avgpu: float
   pk: [datatagid,normtagid]
   
BX_PLT_RESULT_&suffix:
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxlumi: float
   pk: [datatagid,bxidx]

BCM1F_RESULT_&suffix:
   columns:
    - datatagid: int64
    - normtagid: int64
    - avglumi: float
    - recorded: float
    - avgpu: float
   pk: [datatagid,normtagid]
   
BX_BCM1F_RESULT_&suffix:
   columns:
    - datatagid: int64
    - bxidx: uint16
    - bxlumi: float
   pk: [datatagid,bxidx]

ONLINE_RESULT_&suffix:
   columns:
    - runnum: uint32
    - lsnum: uint32
    - fillnum: uint32
    - cmson: bool
    - beamstatus: string
    - delivered: float
    - recorded: float
    - avgpu: float
    - datasource: string
    - normtagid: int64
   pk: [runnum,lsnum]

BX_ONLINE_RESULT_&suffix:
   columns:
    - runnum: uint32
    - lsnum: uint32
    - bxidx: uint16
    - delivered: float
    - recorded: float
   pk: [runnum,lsnum,bxidx]

OFFLINE_RESULT_&suffix:
   columns:
    - runnum: uint32
    - lsnum: uint32
    - fillnum: uint32
    - cmson: bool
    - beamstatus: string
    - delivered: float
    - recorded: float
    - avgpu: float
    - datasource: string
    - datatagid: int64
    - normtagid: int64
   pk: [runnum,lsnum]
   
BX_OFFLINE_RESULT_&suffix:
   columns:
    - runnum: uint32
    - lsnum: uint32
    - bxidx: uint16
    - delivered: float
    - recorded: float
   pk: [runnum,lsnum,bxidx]
